<!-- Main content -->
<section class="content">
	<div class="row">
		<div class="col-xs-12">
			<div class="box width_70">
				<div class="box-header">
					<h3 class="box-title col-lg-10 col-md-9 col-sm-9 col-xs-9">添加收费项</h3>
					<a onclick='loadpage("/org_plat/pages/examination/charges/feeItem.html")' class="btn btn-default">返回</a>
				</div>
			</div>
		</div>
	</div>
	<div class="box width_70">
		<div class="box-body">
			<div class="row user_power_btn">
				<form class="form-group container-fluid" id="addFeeItemForm">
					<div class="row margin-bottom">
						<div class="col-md-2 col-md-offset-5">
							<h4 class="box-title">基本信息</h4>
						</div>
					</div>
					<div class="col-md-5 col-md-push-1">
						<div class="input-group margin-bottom">
							<span class="input-group-addon">收费项名称</span>
							<input type="text" class="form-control" name="examFeeItemName" id="addExamFeeItemName">
						</div>
						<div id="addExamFeeItemNameTip"></div>
						<div class="input-group margin-bottom">
							<span class="input-group-addon">收费项名称简称</span>
							<input type="text" class="form-control" name="examFeeItemNameAbr" id="addExamFeeItemNameAbr">
						</div>
						<div id="addExamFeeItemNameAbrTip"></div>
						<div class="input-group margin-bottom">
							<span class="input-group-addon">收费项英文名称</span>
							<input type="text" class="form-control" name="examFeeItemNameEng" id="addExamFeeItemNameEng">
						</div>
						<div id="addExamFeeItemNameEngTip"></div>
						<div class="input-group margin-bottom">
							<span class="input-group-addon">英文名称缩写</span>
							<input type="text" class="form-control" name="examFeeItemNameEngAbr" id="addExamFeeItemNameEngAbr">
						</div>
						<div id="addExamFeeItemNameEngAbrTip"></div>
					</div>
					<div class="col-md-5 col-md-push-1">
						<div class="input-group margin-bottom">
							<span class="input-group-addon">收费项目HIS名称</span>
							<input type="text" class="form-control" name="examFeeItemHisName" id="addExamFeeItemHisName">
						</div>
						<div id="addExamFeeItemHisNameTip"></div>
						<div class="input-group margin-bottom">
							<span class="input-group-addon">门店</span>
							<select class="form-control selectpicker" id="branch" name="organizationBranchId">
							</select>
						</div>
						<div id="branchTip"></div>
						<div class="input-group margin-bottom">
							<span class="input-group-addon">上级科室</span>
							<select class="form-control selectpicker SuperiorDepartment" id="dept" name="departmentId">
							</select>
						</div>
						<div id="deptTip"></div>
						<div class="input-group margin-bottom" id="addSex">
							<span class="input-group-addon userlist_status_right_border">适用性别</span>
							<label class="radio-inline">
								<input type="checkbox" name="sex" value="1" id="addfMale"> 适用男
								<input type="hidden" name='fMale' value="1" id="addfMaleHidden" >
						    </label>
							<label class="radio-inline">
								<input type="checkbox" name="sex" value="1" id="addfFemale" id="examSuiteFemale"> 适用女
								<input type="hidden" name='fFemale' value="1" id="addfFemaleHidden" >
							</label>
						</div>
						<div id="sexTip"></div>
					</div>
					<div class="row margin-bottom">
						<div class="col-md-2 col-md-offset-5">
							<h4 class="box-title">详细信息</h4>
						</div>
					</div>
					<div class="col-md-5 col-md-push-1">
						<div class="input-group margin-bottom">
							<span class="input-group-addon">收费项目代码</span>
							<input type="text" class="form-control" name="examFeeItemCode" id="addExamFeeItemCode">
						</div>
						<div id="addExamFeeItemCodeTip"></div>
						<div class="input-group margin-bottom">
							<span class="input-group-addon">收费项目收费代码</span>
							<input type="text" class="form-control" name="examFeeItemFeeCode" id="addExamFeeItemFeeCode">
						</div>
						<div id="addExamFeeItemFeeCodeTip"></div>
						<div class="input-group margin-bottom">
							<span class="input-group-addon">套餐内价格</span>
							<input type="text" class="form-control" name="examFeeItemSuitePrice" id="addExamFeeItemSuitePrice">
						</div>
						<div id="addExamFeeItemSuitePriceTip"></div>
						<div class="input-group margin-bottom">
							<span class="input-group-addon">成本价</span>
							<input type="text" class="form-control" name="examFeeItemCostPrice" id="addExamFeeItemCostPrice">
						</div>
						<div id="addExamFeeItemCostPriceTip"></div>
					</div>
					<div class="col-md-5 col-md-push-1">
						<div class="input-group margin-bottom">
							<span class="input-group-addon">单价</span>
							<input type="text" class="form-control" name="examFeeItemUnitPrice" id="addExamFeeItemUnitPrice">
						</div>
						<div id="addExamFeeItemUnitPriceTip"></div>
						<div class="input-group margin-bottom">
							<span class="input-group-addon">外送价</span>
							<input type="text" class="form-control" name="examFeeItemCoopPrice" id="addExamFeeItemCoopPrice">
						</div>
						<div id="addExamFeeItemCoopPriceTip"></div>
						<div class="input-group margin-bottom">
							<span class="input-group-addon">耗材价</span>
							<input type="text" class="form-control" name="examFeeItemMaterialPrice" id="addExamFeeItemMaterialPrice">
						</div>
						<div id="addExamFeeItemMaterialPriceTip"></div>
						<div class="input-group margin-bottom">
							<span class="input-group-addon">说明</span>
							<input type="text" class="form-control" name="note" id="addNote">
						</div>
						<div id="addNoteTip"></div>
					</div>
					<div class="row margin-bottom">
						<div class="col-md-2 col-md-offset-6">
							<div class="row">
								<div class="input-group">
									<button type="submit" class="btn btn-primary" data-dismiss="modal" id='addFeeItemSave'>保存</button>
								</div>
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>

</section>
<script src="/org_plat/js/plugins/jQuery-2.2.0.min.js"></script>
<script src="/org_plat/js/plugins/bootstrap.min.js"></script>
<script src="/org_plat/js/plugins/formValidator-4.0.1.js"></script>
<script src="/org_plat/js/plugins/formValidatorRegex.js"></script>
<script>
	//校验
	$(document).ready(function() {
		//	性别传值
		$(":checkbox[name='sex']").on('change', function() {
			var addfMale = $('#addfMale').attr('checked');
			var addfFemale = $('#addfFemale').attr('checked');
			if(addfMale == true) {
				$('#addfMaleHidden').val('0');
			}else{
				$('#addfMaleHidden').val('1');
			}
			if(addfFemale == true) {
				$('#addfFemaleHidden').val('0');
			}else{
				$('#addfFemaleHidden').val('1');
			}
		})

		$.formValidator.initConfig({
			submitButtonID: "addFeeItemSave",
			debug: true,
			onSuccess: function() {
				addSuitItem();
			},
			onError: function() {
				alert("添加失败，具体错误，请看网页上的提示！")
			}
		});
		$('#addExamFeeItemName').formValidator({
			onShow: "请输入至少3字符的收费项名称!",
			onFocus: "请输入至少3字符的收费项名称!",
			onCorrect: "输入正确!"
		}).inputValidator({
			min: 3,
			max: 20,
			onError: "输入有误,请确认!"
		})
		$('#addExamFeeItemNameAbr').formValidator({
			onShow: "请输入至少2字符的收费项简称!",
			onFocus: "请输入至少2字符的收费项简称!",
			onCorrect: "输入正确!"
		}).inputValidator({
			min: 2,
			max: 20,
			onError: "输入有误,请确认!"
		})

		$('#addExamFeeItemNameEng').formValidator({
			onShow: "请输入至少2字符的收费项英文名称!",
			onFocus: "请输入至少2字符的收费项英文名称!",
			onCorrect: "输入正确!"
		}).inputValidator({
			min: 2,
			max: 20,
			onError: "输入有误,请确认!"
		}).regexValidator({
			regExp: "letter",
			dataType: "enum",
			onError: "输入有误,请确认!"
		});
		$('#addExamFeeItemHisName').formValidator({
			onShow: "请输入至少2字符的收费项目HIS名称!",
			onFocus: "请输入至少2字符的收费项目HIS名称!",
			onCorrect: "输入正确!"
		}).inputValidator({
			min: 2,
			max: 20,
			onError: "输入有误,请确认!"
		})
		$('#branch').formValidator({
			onShow: "请选择门店!",
			onFocus: "请选择门店!",
			onCorrect: "输入正确!"
		}).inputValidator({
			min: 1,
			onError: "你还没有选择门店!"
		})
		$('#dept').formValidator({
			onShow: "请选择上级科室!",
			onFocus: "请选择上级科室!",
			onCorrect: "输入正确!"
		}).inputValidator({
			min: 1,
			onError: "你还没有选择上级科室!"
		})
		$(":checkbox[name='sex']").formValidator({
			tipID: "sexTip",
			onShow: "请至少选择一个性别!",
			onFocus: "请至少选择一个性别!",
			onCorrect: "已选择"
		}).inputValidator({
			min: 1,
			onError: "请至少选择一个性别!"
		});

		$('#addExamFeeItemCode').formValidator({
			onShow: "请输入至少1位的收费项目代码!",
			onFocus: "请输入至少1位的收费项目代码!",
			onCorrect: "输入正确!"
		}).inputValidator({
			min: 1,
			max: 20,
			onError: "输入有误,请确认!"
		}).regexValidator({
			regExp: "num",
			dataType: "enum",
			onError: "输入有误,请确认!"
		});
		$('#addExamFeeItemFeeCode').formValidator({
			onShow: "请输入至少1位的项目收费代码!",
			onFocus: "请输入至少1位的项目收费代码!",
			onCorrect: "输入正确!"
		}).inputValidator({
			min: 1,
			max: 20,
			onError: "输入有误,请确认!"
		}).regexValidator({
			regExp: "num",
			dataType: "enum",
			onError: "输入有误,请确认!"
		});
		$('#addExamFeeItemFeeCode').formValidator({
			onShow: "请输入至少1位的项目收费代码!",
			onFocus: "请输入至少1位的项目收费代码!",
			onCorrect: "输入正确!"
		}).inputValidator({
			min: 1,
			max: 20,
			onError: "输入有误,请确认!"
		}).regexValidator({
			regExp: "num",
			dataType: "enum",
			onError: "输入有误,请确认!"
		});
		$('#addExamFeeItemSuitePrice').formValidator({
			onShow: "请输入套餐内价格!",
			onFocus: "请输入套餐内价格!",
			onCorrect: "输入正确!"
		}).inputValidator({
			min: 1,
			max: 20,
			onError: "输入有误,请确认!"
		}).regexValidator({
			regExp: "num",
			dataType: "enum",
			onError: "输入有误,请确认!"
		});
		$('#addExamFeeItemSuitePrice').formValidator({
			onShow: "请输入套餐内价格!",
			onFocus: "请输入套餐内价格!",
			onCorrect: "输入正确!"
		}).inputValidator({
			min: 1,
			max: 20,
			onError: "输入有误,请确认!"
		}).regexValidator({
			regExp: "num",
			dataType: "enum",
			onError: "输入有误,请确认!"
		});
		$('#addExamFeeItemCostPrice').formValidator({
			onShow: "请输入成本价!",
			onFocus: "请输入成本价!",
			onCorrect: "输入正确!"
		}).inputValidator({
			min: 1,
			max: 20,
			onError: "输入有误,请确认!"
		}).regexValidator({
			regExp: "num",
			dataType: "enum",
			onError: "输入有误,请确认!"
		});
		$('#addExamFeeItemUnitPrice').formValidator({
			onShow: "请输入单价!",
			onFocus: "请输入单价!",
			onCorrect: "输入正确!"
		}).inputValidator({
			min: 1,
			max: 20,
			onError: "输入有误,请确认!"
		}).regexValidator({
			regExp: "num",
			dataType: "enum",
			onError: "输入有误,请确认!"
		});
		$('#addExamFeeItemCoopPrice').formValidator({
			onShow: "请输入外送价!",
			onFocus: "请输入外送价!",
			onCorrect: "输入正确!"
		}).inputValidator({
			min: 1,
			max: 20,
			onError: "输入有误,请确认!"
		}).regexValidator({
			regExp: "num",
			dataType: "enum",
			onError: "输入有误,请确认!"
		});
		$('#addExamFeeItemMaterialPrice').formValidator({
			onShow: "请输入耗材价!",
			onFocus: "请输入耗材价!",
			onCorrect: "输入正确!"
		}).inputValidator({
			min: 1,
			max:20,
			onError: "输入有误,请确认!"
		}).regexValidator({
			regExp: "num",
			dataType: "enum",
			onError: "输入有误,请确认!"
		});
		$('#addNote').formValidator({
			onShow: "请输入50字以内的说明!",
			onFocus: "请输入50字以内的说明!",
			onCorrect: "输入正确!"
		}).inputValidator({
			min: 1,
			max: 100,
			onError: "输入有误,请确认!"
		})

	})
	branchDeptInfo();
	$('#branch').change(function() {
		if($('#branch').val() != '') {
			SuperiorDepartment($('#branch').val(), '#dept','1');
		}
	})

	function branchDeptInfo() {
		getBranchName("#branch","1");
		$('#branch').val('');
		SuperiorDepartment($('#branch').val(), '#dept','1');
	}
	//  编辑保存信息
	function addSuitItem() {
		if($('#addfMale').is(':checked')) {
			$("#addfMaleHidden").val("0");
		}
		if($('#addfFemale').is(':checked')) {
			$("#addfFemaleHidden").val("0");
		}
		var deptText = $("#dept").find("option:selected").text();
		var branch = $('#branch').val();
		var dept = $('#dept').val();
		var param = $('#addFeeItemForm').serialize();
		var otype = "post";
		var osync = false;
		var reqResult = httpRequest(insertOrgExamFeeItemUrl, param, otype, osync);
		if(reqResult.result == 0) {
			alert('添加成功!');
			loadpage("/org_plat/pages/examination/charges/feeItem.html");
		} else {
			alert(reqResult.message);
		}
	}
</script>